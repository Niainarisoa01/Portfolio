[phases.setup]
nixPkgs = ['nodejs', 'python39', 'python39Packages.pip']

[phases.install]
cmds = [
  'python -m pip install --upgrade pip',
  'pip install -r requirements.txt',
  'npm ci'
]

[phases.build]
cmds = [
  'mkdir -p static/css',
  'CI=false npm run build'
]

[start]
cmd = 'gunicorn wsgi:app --bind=0.0.0.0:$PORT --log-file -'

[deploy]
startCommand = 'gunicorn wsgi:app --bind=0.0.0.0:$PORT --log-file -'
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 3 